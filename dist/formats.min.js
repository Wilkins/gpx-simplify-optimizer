function filesizeHuman(a,b){if(0===a)return a;b=b||1;var c=["Bytes","KB","MB","GB","TB"],d=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return(a/Math.pow(1024,d)).toFixed(b)+" "+c[d]}function nodes2Bytes(a){return filesizeHuman(400+56*a)}function getPosition(a){for(var b=0,c=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{x:b,y:c}}function hideAll(){$(".popup").each(function(){$(this).hide()}),hideLanguages()}function chooseDownloadFormat(a){hideAll();var b=getPosition(a.currentTarget);$("#download-formats").css("top",b.y-4),$("#download-formats").show()}function chooseViewFormat(a){hideAll();var b=getPosition(a.currentTarget);$("#view-formats").css("top",b.y-4),$("#view-formats").show(),$("#download-formats").hide()}function GeoJSONFormat(){this.param={key:"geojson",syntax:"json",name:"GeoJSON",extension:"geojson",contenttype:"appplication/json"},this.exportData=function(a){return JSON.stringify(a)},this.display=function(a){return prettyData.json(a)}}function GPXFormat(){this.param={key:"gpx",syntax:"xml",name:"GPX",extension:"gpx",contenttype:"application/gpx+xml"},this.exportData=function(a){return togpx(a)},this.display=function(a){return prettyData.xml(a)}}function KMLFormat(){this.param={key:"kml",syntax:"xml",name:"KML",extension:"kml",contenttype:"application/vnd.google-earth.kml+xml"},this.exportData=function(a){return tokml(a)},this.display=function(a){return prettyData.xml(a)}}function MediawikiFormat(){this.param={key:"mediawiki",syntax:"nohighlight",name:"Mediawiki",extension:"txt",contenttype:"text/plain"},this.exportData=function(a){return geojsonToPath(a)}}$("#export-close").on("click",function(){$("#export-format").hide()});var Format=function(){this.param={key:"format",name:"RootFormat"}};Format.prototype={loadAll:function(a){a.forEach(function(a){f=new window[a],f.load()})},load:function(){var a=document.createElement("a"),b=document.createTextNode($.t("export.viewin",{format:this.param.name}));a.appendChild(b),a.title=$.t("export.viewtitle",{format:this.param.name}),a.className="view",$(a).on("click",this.viewClick.bind(this)),$("#view-formats").append(a),a=document.createElement("a"),b=document.createTextNode($.t("export.downloadin",{format:this.param.name})),a.appendChild(b),a.title=$.t("export.downloadtitle",{format:this.param.name}),a.className="download",$(a).on("click",this.saveClick.bind(this)),$("#download-formats").append(a)},display:function(a){return a},save:function(a){name=a.name.replace(/\..*/,""),name=name+"_"+a.simplifiedLayerNodes+"nodes."+this.param.extension;try{if(new Blob){var b=this.exportData(a.simplifiedLayerData),c=new Blob([b],{type:this.param.contenttype+";charset=utf-8"});saveAs(c,name)}}catch(d){alert($.t("upload.none")+" "+d.message),console.log(d.message)}hideAll()},saveClick:function(){this.save(window.currentLayer)},view:function(a){try{if(new Blob){var b=this.exportData(a.simplifiedLayerData);b=this.display(b),$("code").attr("class",this.param.syntax),$("#export-content").text(b),a.simplifiedLayerNodes<1e3&&$("code").each(function(a,b){hljs.highlightBlock(b)}),$("#export-format h5").html($.t("export.title",{format:this.param.name})),$("#export-format").show()}}catch(c){alert($.t("upload.none")+" "+c.message),console.log(c.message)}hideAll()},viewClick:function(){this.view(window.currentLayer)}},GeoJSONFormat.prototype=new Format,GPXFormat.prototype=new Format,KMLFormat.prototype=new Format,MediawikiFormat.prototype=new Format;